#!/usr/bin/env python2
import sys
import rf95
import time

lora = rf95.RF95(0, 25, None, 13)

def send(val):
    print("sending: " + val)
    lora.send(lora.str_to_data(val))
    lora.wait_packet_sent()
    transmit_len = len(val.encode("utf8"))
    print("bytes sent: " + str(transmit_len))

def main():

    print("------------------------------------------------------")
    if not lora.init(): # returns True if found
        print("RF95 not found or not ready")
        lora.cleanup()
        quit(1)
    else:
        print("RF95 LoRa Ready")
    print("------------------------------------------------------")
        
    try:
        freq = 434.00

       
        print("frequency = " + str(freq))
        lora.set_frequency(freq)
        lora.set_tx_power(15)
        time.sleep(2);
        
         # set frequency
        if len(sys.argv) > 1:
            send(sys.argv)
        else:
            # send test data
            send('hello::world')

    except KeyboardInterrupt:
        print("closing...")
        # clean up
        lora.cleanup()


if __name__ == '__main__':
   main()