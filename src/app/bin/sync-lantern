#!/usr/bin/env node

console.log("starting sync for lantern...");

var done = (function wait() { 
    if (!done) {
        setTimeout(wait, 1000)
    }
    else {
        setTimeout(process.exit, 100);
    }
})();

var PouchDB = require('lantern-serve').PouchDB;
var local_db = PouchDB("http://localhost/db/lnt");
var lantern_db = PouchDB("http://lantern.global/db/lnt");


var sync = local_db.sync(lantern_db, { 
        live: false, 
        retry: false
    })
    .on('change', function (change) {
        if (change.direction) {
            console.log("[sync] " + change.direction  + " docs: " + 
                    change.change.docs_read + " read / " + 
                    change.change.docs_written + " written"
                );
        }
        else {
            console.log("[sync] change: ", change);
        }
    })
    .on('complete', function() {
        console.log("[sync] complete");
        done = true;
        process.exit(0);9
    })
    .on('error', function (err) {
        console.log("err: ", err);
        done = true;
        process.exit(1);
    });